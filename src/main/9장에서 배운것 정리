Travis CI 배포 자동화

1. CI & CD 소개
    스크립트를 개발자가 직접 실행해서 발생하는 불편을 경험.
        CI(continuous integration 지속적 통합): 코드버전을 관리하는 VCS시스템에 PUSH가 되면 자동으로 테스트와 빌드가 수행되어 배포파일을 만드는과정.
        CD(continuous deployment 지속적 배포) : push되면 자동으로 테스트와 빌드가 수행되어 안정적인 배포파일을 만드는 과정
    CI 도구를 도입했다고해서 CI를 하는 것은 아님
        CI의 규칙
            모든 소스코드가 현재 실행되고 누구든 현재의 소스에 접근할 수 있는 단일지점을 유지할 것.
            빌드 프로세스를 자동화해서 누구든 소스로부터 시스템을 빌드하는 단일 명령어를 사용할 수 있게 할 것
            테스팅을 자동화해서 단일 명령어로 언제든지 시스템에 대한 건전한 테스트 수트를 실행할 수 있게 할 것
            누구나 현재 실행파일을 얻으면 지금까지 가장 완전한 실행파일을 얻었다는 확신을 하게 할 것.

2. Travis CI 연동하기
    Travis CI : 깃허브에서 제공하는 무료 ci서비스
    Travis CI 웹서비스 설정
        https://travis-ci.org/ 로그인-> 계정명->settings에서 설정
    프로젝트 설정
        travis ci 상세설정은 프로젝트에 존재하는 .travis.yml 파일로 가능
            yml은 YAML(야믈)이라 지칭, JSON에서 괄호를 제거한 것. 기계에서 파싱하기 쉽게, 사람이 다루기 쉽게가 이념.
        build.gradle과 같은 위치에서 .travis.yml 생성.
            language: java
            jdk:
                -openjdk8
            branches: //Travis CI를 어느 브랜치가 푸시될 때 수행할 지 지정. 현 옵션은 master 브랜치에 push될 때 수행.
              only:
                - master

            # Travis CI 서버의 HOME
            cache: //그레이들을 통해 의존성을 받으면 이를 해당 디렉토리에 캐시하여, 같은 의존성은 다음 배포 때부터 받지 않도록 설정
              directories:
                - '$HOME/.m2/repository'
                - '$HOME/.gradle'
              script: "./gradlew clean build" // master브랜치에 푸시되었을 때 수행하는 명렁어. 여기서는 프로젝트 내부에 둔 gradlew을 통해 clean & build를 수행.

            #CI 실행 완료시 메일로 알람
            notifications: //travis ci 실행 완료시 자동으로 알람이 가도록 설정.
              email:
                recipients:
                  - nidlu1@naver.com

        master브랜치에 커밋과 푸시함. 1번 테스트 실패.

3. travis ci와 aws s3 연동하기
    s3: aws에서 제공하는 일종의 파일 서버. 이미지를 비롯한 정적파일 관리하거나, 지금 진행하는 것처럼 배포파일들을 관리하는 기능 지원.
        이미지 업로드를 구현시 s3를 이용해 구현.
    travis ci 연동시 구조: https://jojoldu.tistory.com/265
        s3을 연동이 먼저 필요한 이유는 jar를 전달하기 위해.
        codedeploy는 저장기능이 없음. 그래서 travis ci 가 빌드한 결과물을 받아서 codedeploy가 가져갈 수 있도록 공간이 필요해 aws s3을 이용함.

    AWS key 발급
        일반적으로 AWS서비스에 외부서비스 접근 불가능. 접근가능한 key를 생성해야함. IAM가 서비스함.
            사용자추가: 엑세스유형은 프로그래밍방식.
            권한정책은 기존정책 직접연결-> amazons3fullaccess 체크, AWSCodeDeployFullAccess 체크
            태그는 nidlu
        사용자: nidlu-travis-deploy
        액세스키: AKIAZ5XBFTYAWINLND6Z
        비밀엑세스키: EQJeq/AFuo5bqHjKxjzxB8tnHfxQ25K8sVhe7cjf

    travis CI에 키등록
        more option - setting - Environment Variables
        $변수명으로 yml에서 사용가능.